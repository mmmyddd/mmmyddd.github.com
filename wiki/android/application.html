<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-triditional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/>
    <title>
      Justin's Wiki - Application Development</title>
    <link rel="alternate" type="application/rss+xml" title="RSS" href="http://mmmyddd.github.io/wiki/res/rss.xml" />
    <link rel="shortcut icon" href="/image/favicon.ico" />
    <link rel="stylesheet" type="text/css" charset="utf-8" media="all" href="../res/css/common2.css"/>
<link rel="stylesheet" type="text/css"  charset="utf-8" media="screen" href="../res/css/screen.css"/>
<link rel="stylesheet" type="text/css" charset="utf-8" media="print" href="../res/css/print.css"/>
<!--[if IE]><link rel="stylesheet" type="text/css" charset="utf-8" href="../res/css/iehacks.css"/>
<![endif]-->
<!--[if lte IE 6]><link rel="stylesheet" type="text/css" charset="utf-8" href="../res/css/ie6hacks.css"/>
<![endif]-->


    <script type="text/javascript" src="../res/js/scripts/shCore.js"></script>
    <script type="text/javascript" src="../res/js/scripts/shBrushCss.js"></script>
    <script type="text/javascript" src="../res/js/scripts/shBrushJava.js"></script>
    <script type="text/javascript" src="../res/js/scripts/shBrushPython.js"></script>
    <script type="text/javascript" src="../res/js/scripts/shBrushXml.js"></script>
    <script type="text/javascript" src="../res/js/scripts/shBrushPlain.js"></script>
    <script type="text/javascript" src="../res/js/scripts/shBrushPerl.js"></script>
    <script type="text/javascript" src="../res/js/scripts/shBrushBash.js"></script>
    <script type="text/javascript" src="../res/js/scripts/shBrushJScript.js"></script>
    <script type="text/javascript" src="../res/js/scripts/shBrushCpp.js"></script>
    <script type="text/javascript" src="../res/js/scripts/shBrushSql.js"></script>
    <script type="text/javascript" src="../res/js/scripts/shBrushDiff.js"></script>
    <link type="text/css" rel="stylesheet" href="../res/css/styles/shCore.css"/>
    <link type="text/css" rel="stylesheet" href="../res/css/styles/shThemeDefault.css"/>
    <script type="text/javascript">
      SyntaxHighlighter.config.clipboardSwf = '../res/js/scripts/clipboard.swf';
      SyntaxHighlighter.all();
    </script>

    <script type="text/javascript" src="../res/js/audio-player.js"></script>
    <script type="text/javascript">
      AudioPlayer.setup("../res/js/audioplayer.swf", {
      width: 290,
      transparentpagebg: "yes"
      });
    </script>

    <script type="text/javascript" src="../res/js/swfobject.js"></script>
    <script type="text/javascript">
      var media_player = "..//res/js/player.swf";
    </script>

    <meta name="description" content="Michael Olson, maintainer of Emacs Muse and ERC" />
    <meta name="keywords" content="" />
    <meta name="generator" content="Muse" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <script type="text/javascript" src="../res/js/collapsible.js" >
    </script>
  </head>

  <body>
    <a name="top"></a>
    <div class="banner" id="banner">
      <div class="logo">
        <a href="/wiki/./index.html" style="text-decoration: none;">
          <img src="/image/wiki-logo.png" alt="Justin's Wiki" />
        </a>
      </div>
      <form action="http://www.google.com/cse" id="cse-search-box">
        <span id="gsearch">
          &nbsp;
        </span>
        <a href="/wiki/res/rss.xml">
          <img src="/image/rss.png" style="border:0pt none;width:47px;height:17px;top:0px;" alt="rss" />
        </a>
      </form>
    </div>

    <div class="navbar" id="navbar">
      <div>
        &nbsp;
        <a href="/">Home</a>
        &#187; 
<a href="/wiki/./index.html">学习笔记</a>
&#187; 
<a href="/wiki/android/index.html">Android操作系统</a>

      </div>
      <ul>
        <li><a href="/blog-res/blog?/about">About</a> </li>
        &nbsp; :: &nbsp;
        <li><a href="/blog-res/blog">Blog</a></li>
        &nbsp; :: &nbsp;
        <li><a href="/wiki/./index.html">Wiki</a></li>
        &nbsp; :: &nbsp;
        <li><a href="/article/index.html">Article</a></li>
        &nbsp; :: &nbsp;
        <li><a href="/blog-res/blog?/bookmarks">Bookmarks</a></li>
        &nbsp; :: &nbsp;
        <li><a href="/blog-res/blog?/projects">Projects</a></li>
        &nbsp; :: &nbsp;
        <li><a href="/blog-res/blog?/Albums">Albums</a></li>
        &nbsp;&nbsp;
      </ul>
    </div>
  <!-- Page published by Emacs Muse begins here -->
  <div class="container" id="container">

    <!--navigation-->
    <div class="topic" id="topic">
      <ul id="outer">
        <!-- Wiki projects tree -->
        Loading ...
      </ul>
    </div>

    <!-- collapsible arrow -->
    <div class="muse-content" id="muse-content" >
      <!-- collapsible splitter -->
      <div id="collapsible"></div>
      <div class="padding">&nbsp;</div>
      <!--muse generated -->
      <div class="pretty-title">
        Application Development
      </div>
<table><tr><td class="contents"><div><div class="toggle">Contents&nbsp;[<a id="hide" href="javascript:hideContents();">Hide</a><a id="show" href="javascript:showContents();" style="display:none">Show</a>]</div>
<dl id="content-list">
<dt>
<a href="#sec1">1 Create an Activity</a>
</dt>
<!-- print entries -->
<dd>
<dl>
<!-- open subopen -->
<dt>
<a href="#sec2">1.1 Install Apache Ant</a>
</dt>
<!-- print entries -->
<dt>
<a href="#sec3">1.2 Create Android Activity Project</a>
</dt>
<!-- print entries -->
<dt>
<a href="#sec4">1.3 Using 'Anroid' script instead of 'activitycreator'</a>
</dt>
<!-- print entries -->
</dl>
</dd>
<!-- close subopen -->
<dt>
<a href="#sec5">2 Edit the code</a>
</dt>
<!-- print entries -->
<dt>
<a href="#sec6">3 Sign your application</a>
</dt>
<!-- print entries -->
<!-- before end -->
</dl>
</div></td></tr></table>
<!-- after end -->



<h2><span class="toplink"><a href="#top"><img src="/wiki/res/image/btn_top.png"></a></span><a name="sec1" id="sec1"></a>
Create an Activity</h2>

<p class="first">这里给出以命令行方式创建Android应用的步骤, 所使用的<a href="http://mmmyddd.github.io/wiki/android/index.html">android</a> SDK为<a href="http://mmmyddd.github.io/wiki/android/build.html">Build Android Platform</a>一文中
用make sdk命令构建出来的SDK。</p>

<p>注意：<a href="http://mmmyddd.github.io/wiki/android/index.html">android</a> SDK的主页已经转移到<a href="http://developer.android.com">http://developer.android.com</a></p>

<h3><span class="toplink"><a href="#top"><img src="/wiki/res/image/btn_top.png"></a></span><a name="sec2" id="sec2"></a>
Install Apache Ant</h3>

<p class="first">首先需要安装Apache Ant。</p>

<p>在Apache Ant的主页上<a href="http://ant.apache.org/">http://ant.apache.org/</a>
下载Ant到~/<a href="http://mmmyddd.github.io/wiki/android/index.html">android</a>/downloads/apache-ant-1.7.1-bin.tar.gz</p>

<p>然后将其解压缩到/usr/local/apache-ant-1.7.1</p>

<p>在~/.bashrc中增添以下脚本：</p>

<pre class="example">
export ANT_HOME=/usr/local/apache-ant-1.7.1
export PATH=${PATH}:${ANT_HOME}/bin
</pre>


<h3><span class="toplink"><a href="#top"><img src="/wiki/res/image/btn_top.png"></a></span><a name="sec3" id="sec3"></a>
Create Android Activity Project</h3>

<p class="first">根据
<a href="http://code.google.com/android/reference/othertools.html">http://code.google.com/android/reference/othertools.html</a>
中所述，
在执行make sdk命令后（可参考<a href="http://mmmyddd.github.io/wiki/android/build.html#SDK">Build SDK</a>），
似乎可以用新build出来的SDK的tools下边activitycreator脚本来
创建新的应用。</p>

<pre class="example">
cd ~/android/src/out/host/linux-x86/sdk/android-sdk_eng.justin_linux-x86/tools/
./activitycreator --out HelloWorld com.android.hello.HelloWorld
</pre>

<p>但是发现报出如下错误：</p>

<pre class="example">
ERROR: Target platform templates directory does not exist.
</pre>

<p>原因在~/<a href="http://mmmyddd.github.io/wiki/android/index.html">android</a>/src/development/tools/activitycreator/src/com/<a href="http://mmmyddd.github.io/wiki/android/index.html">android</a>/activitycreator/<a href="ActivityCreator">Activity Creator</a>.java
中默认模版路径为：</p>

<pre class="example">
// FIXME: target platform must be provided by the user
private final String mTargetPlatform = &quot;android-1.1&quot;;
</pre>

<p>而实际上在SDK目录下的platforms中只有<a href="http://mmmyddd.github.io/wiki/android/index.html">android</a>-1.5目录：</p>

<pre class="example">
  /home/justin/android/src/out/host/linux-x86/sdk/android-sdk_eng.justin_linux-x86/platforms:
  总计 12
  drwxrwx--- 3 justin justin 4096 02-15 19:09 .
  drwxrwx--- 6 justin justin 4096 02-13 17:06 ..
  drwxrwx--- 7 justin justin 4096 02-13 17:06 android-1.5
</pre>

<p>因此需要修改mTargetPlatform变量并重新编译SDK
，或者做一个符号链结：</p>

<pre class="example">
  /home/justin/android/src/out/host/linux-x86/sdk/android-sdk_eng.justin_linux-x86/platforms:
  总计 12
  drwxrwx--- 3 justin justin 4096 02-15 19:09 .
  drwxrwx--- 6 justin justin 4096 02-13 17:06 ..
  lrwxrwxrwx 1 justin justin   12 02-15 19:09 android-1.1 -&gt; android-1.5/
  drwxrwx--- 7 justin justin 4096 02-13 17:06 android-1.5
</pre>

<p>在次运行脚本，在创建好目录结构后又发生错误：</p>

<pre class="example">
Package: com.android.hello
Output directory: HelloAndroid
Tests directory: HelloAndroid/tests
Activity name: HelloAndroid
ActivityTest name: HelloAndroidTest
Created directory /home/justin/android/src/out/host/linux-x86/sdk/android-sdk_eng.justin_linux-x86/tools/HelloAndroid/src/
com/android/hello
Added file HelloAndroid/src/com/android/hello/HelloAndroid.java
Created directory /home/justin/android/src/out/host/linux-x86/sdk/android-sdk_eng.justin_linux-x86/tools/HelloAndroid/bin
Created directory /home/justin/android/src/out/host/linux-x86/sdk/android-sdk_eng.justin_linux-x86/tools/HelloAndroid/libs
Created directory /home/justin/android/src/out/host/linux-x86/sdk/android-sdk_eng.justin_linux-x86/tools/HelloAndroid/res
Created directory /home/justin/android/src/out/host/linux-x86/sdk/android-sdk_eng.justin_linux-x86/tools/HelloAndroid/test
s/src/com/android/hello
Added file HelloAndroid/tests/src/com/android/hello/HelloAndroidTest.java
Created directory /home/justin/android/src/out/host/linux-x86/sdk/android-sdk_eng.justin_linux-x86/tools/HelloAndroid/test
s/bin
Created directory /home/justin/android/src/out/host/linux-x86/sdk/android-sdk_eng.justin_linux-x86/tools/HelloAndroid/test
s/libs
Created directory /home/justin/android/src/out/host/linux-x86/sdk/android-sdk_eng.justin_linux-x86/tools/HelloAndroid/test
s/res
Created directory /home/justin/android/src/out/host/linux-x86/sdk/android-sdk_eng.justin_linux-x86/tools/HelloAndroid/res/
values
Added file HelloAndroid/res/values/strings.xml
Created directory /home/justin/android/src/out/host/linux-x86/sdk/android-sdk_eng.justin_linux-x86/tools/HelloAndroid/res/
layout
Added file HelloAndroid/res/layout/main.xml
Added file HelloAndroid/AndroidManifest.xml
Added file HelloAndroid/build.xml
ERROR: Could not access HelloAndroid/default.properties: /home/justin/android/src/out/host/linux-x86/sdk/android-sdk_eng.k
wgj48_linux-x86/tools/lib/default.properties.template (No such file or directory)
</pre>

<p>此时在~/<a href="http://mmmyddd.github.io/wiki/android/index.html">android</a>/src/out/host/<a href="http://mmmyddd.github.io/wiki/linux/index.html">linux</a>-x86/sdk/<a href="http://mmmyddd.github.io/wiki/android/index.html">android</a>-sdk_eng.justin_<a href="http://mmmyddd.github.io/wiki/linux/index.html">linux</a>-x86/tools/lib目录下
新建空白属性文件default.properties.template即可。</p>

<p>对新建的目录进行编译，运行：</p>

<pre class="example">
cd HelloWorld
ant
</pre>

<p>发现无法构建失败：</p>

<pre class="example">
Buildfile: build.xml

BUILD FAILED
/home/justin/android/src/out/host/linux-x86/sdk/android-sdk_eng.justin_linux-x86/tools/HelloAndroid/build.xml:46: taskdef
class com.android.ant.AndroidInitTask cannot be found

Total time: 2 seconds
</pre>

<p>原来没有找到SDK中的类路径，通过检察build.xml中的属性文件发现：</p>

<pre class="example">
&lt;?xml version=&quot;1.0&quot; ?&gt;
&lt;project name=&quot;HelloAndroid&quot; default=&quot;help&quot;&gt;

    &lt;!-- The local.properties file is created and updated by the 'android' tool.
         It contain the path to the SDK. It should *NOT* be checked in in Version
         Control Systems. --&gt;
    &lt;property file=&quot;local.properties&quot;/&gt;

    &lt;!-- The build.properties file can be created by you and is never touched
         by the 'android' tool. This is the place to change some of the default property values
         used by the Ant rules.
         Here are some properties you may want to change/update:

         application-package
             the name of your application package as defined in the manifest. Used by the
             'uninstall' rule.
         source-folder
             the name of the source folder. Default is 'src'.
         out-folder
             the name of the output folder. Default is 'bin'.

         Properties related to the SDK location or the project target should be updated
          using the 'android' tool with the 'update' action.

         This file is an integral part of the build system for your application and
         should be checked in in Version Control Systems.

         --&gt;
    &lt;property file=&quot;build.properties&quot;/&gt;

    &lt;!-- The default.properties file is created and updated by the 'android' tool, as well
         as ADT.
         This file is an integral part of the build system for your application and
         should be checked in in Version Control Systems. --&gt;
    &lt;property file=&quot;default.properties&quot;/&gt;

    &lt;!-- Custom Android task to deal with the project target, and import the proper rules.
         This requires ant 1.6.0 or above. --&gt;
    &lt;path id=&quot;android.antlibs&quot;&gt;
        &lt;pathelement path=&quot;${sdk-location}/tools/lib/anttasks.jar&quot; /&gt;
        &lt;pathelement path=&quot;${sdk-location}/tools/lib/sdklib.jar&quot; /&gt;
        &lt;pathelement path=&quot;${sdk-location}/tools/lib/androidprefs.jar&quot; /&gt;
    &lt;/path&gt;

    &lt;taskdef name=&quot;androidinit&quot; classname=&quot;com.android.ant.AndroidInitTask&quot;
        classpathref=&quot;android.antlibs&quot;/&gt;

    &lt;!-- Class the Android Init task that will import the proper rule file containing
         all the Ant targets --&gt;
    &lt;androidinit /&gt;
&lt;/project&gt;
</pre>

<p>需要在刚才新建的default.properties.template文件中增加SDK的路径：</p>

<pre class="example">
sdk-location=/home/justin/android/src/out/host/linux-x86/sdk/android-sdk_eng.justin_linux-x86
</pre>

<p>重新运行activitycreator脚本，将模版拷贝至项目目录：</p>

<pre class="example">
./activitycreator --out HelloWorld com.android.hello.HelloWorld
</pre>

<p>然后重新运行ant，构建失败，发现没有指定目标平台：</p>

<pre class="example">
Buildfile: build.xml

BUILD FAILED
/home/justin/android/src/out/host/linux-x86/sdk/android-sdk_eng.justin_linux-x86/tools/HelloAndroid/build.xml:50: Android
 Target is not set.

Total time: 4 seconds
</pre>

<p>需要在default.properties.template中增加：</p>

<pre class="example">
target=android-3
</pre>

<p>再次运行activitycreator更新项目目录，运行ant脚本，构建通过：</p>

<pre class="example">
Buildfile: build.xml
[androidinit] Project Target: Android 1.5
[androidinit] Platform Version: 1.5
[androidinit] API level: 3

help:
     [echo] Android Ant Build. Available targets:
     [echo]    help:      Displays this help.
     [echo]    debug:     Builds the application and sign it with a debug key.
     [echo]    release:   Builds the application. The generated apk file must be
     [echo]               signed before it is published.
     [echo]    install:   Installs the debug package onto a running emulator or
     [echo]               device. This can only be used if the application has
     [echo]               not yet been installed.
     [echo]    reinstall: Installs the debug package on a running emulator or
     [echo]               device that already has the application.
     [echo]               The signatures must match.
     [echo]    uninstall: uninstall the application from a running emulator or
     [echo]               device.

BUILD SUCCESSFUL
Total time: 1 second
</pre>

<p>可以发现，这里显示了一些在开发过程中用到构件目标。</p>


<h3><span class="toplink"><a href="#top"><img src="/wiki/res/image/btn_top.png"></a></span><a name="sec4" id="sec4"></a>
Using 'Anroid' script instead of 'activitycreator'</h3>

<p class="first">通过阅读刚才生成的build.xml构件文件，发现SDK tools中的<a href="http://mmmyddd.github.io/wiki/android/index.html">android</a>脚本
可能方便生成项目目录结构。</p>

<p>以下是它的帮助信息：</p>

<pre class="example">
Usage:
  android [global options] action [action options]

Global options:
  -v --verbose  Verbose mode (false)
  -h --help     This help (false)

Valid actions:
- list:       Lists existing targets or VMs.
- vm:         Creates a new VM.
- project:    Creates a new project using a template.
- update:     Updates a new project from existing source (must have an AndroidManifest.xml).

Action &quot;project&quot;:
  Creates a new project using a template.
Options:
  -n --name     Name of the new project
  -o --out      Location path of new project
  -m --mode     Project mode (activity|alias)
  -t --target   Target id of the new project
  -a --activity Activity name
  -p --package  Package name
</pre>

<p>可以看出要创建一个新的项目，可以用<a href="http://mmmyddd.github.io/wiki/android/index.html">android</a>脚本的project子命令：</p>

<p>首先察看一下可用的目标id：</p>

<pre class="example">
cd ~/android/src/out/host/linux-x86/sdk/android-sdk_eng.justin_linux-x86/tools/
android list
</pre>

<p>显示为：</p>

<pre class="example">
ailable Android targets:
[1] Android 1.5
     API level: 3
     Skins: HVGA-P, HVGA-L, QVGA-L, QVGA-P, HVGA
[2] Android 1.5
     API level: 3
     Skins: HVGA-P, HVGA-L, QVGA-L, QVGA-P, HVGA
Available Android VMs:
</pre>

<p>于是，可以用以下命令来新建一个项目目录：</p>

<pre class="example">
mkdir HelloWorld
android project --out HelloWorld --name HelloWorld --target 1  --activity HelloWorld \
        --package com.android.hello
</pre>




<h2><span class="toplink"><a href="#top"><img src="/wiki/res/image/btn_top.png"></a></span><a name="sec5" id="sec5"></a>
Edit the code</h2>





<h2><span class="toplink"><a href="#top"><img src="/wiki/res/image/btn_top.png"></a></span><a name="sec6" id="sec6"></a>
Sign your application</h2>


<!-- Page published by Emacs Muse ends here -->
<!-- disqus -->
<div id="disqus_thread" style="margin-top:100px"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'justinswebsite'; // Required - Replace example with your forum shortname
    var disqus_identifier = 'wiki:android_application';
    var disqus_title = "Justin's Wiki - Application Development";
    var disqus_url = 'http://mmmyddd.github.io/wiki/android/application.html';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">Wiki comments powered by <span class="logo-disqus">Disqus</span></a>

</div><!--end of muse-content -->
</div><!--end of container-->

<div style="clear:both;margin-top:5px;">&nbsp;</div>

<div class="navfoot">
  <hr class="footer-splitter" />
  <table width="100%" summary="Footer navigation">
    <col width="33%" />
    <col width="34%" />
    <col width="33%" />
    <tr>
      <td width="33%" align="left" valign="top" style="line-height:175%">
        <a href="/">
          <img alt="Home" style="border:0;width:230px;height:50px;top:0px;"
               src="/image/test.png" />
        </a>
        <br />
        <span class="footdate">Contact:</span>
        <a href="mailto:mmmyddd[AT]github.io">
          mmmyddd[AT]github.io
        </a>

        <br />
        <span class="footdate">2009-2014 © CopyLeft Contributed</span>
      </td>
      <td width="34%" align="center" valign="top">
      </td>
      <td width="33%" align="right" valign="bottom" style="line-height: 175%">
        <table style="margin: 0 0;padding: 0 0;">
          <tr><td colspan="2" align="right">
            <!-- GoStats JavaScript Based Code -->
            <script type="text/javascript" src="http://gostats.com/js/counter.js"></script>
            <script type="text/javascript">_gos='gostats.com';_goa=745573;
              _got=6;_goi=42;_gol='web site analytics';_GoStatsRun();</script>
            <noscript>
              <a target="_blank" title="web site analytics"
                 href="http://gostats.com">
                <img alt="web site analytics"
                     src="http://gostats.com/bin/count/a_745573/t_6/i_42/counter.png"
                     style="border-width:0" />
              </a>
            </noscript>
            <!-- End GoStats JavaScript Based Code -->
          </td></tr>
          <tr style="margin: 0 0;padding: 0 0;">
            <td style="margin: 0 0;padding: 0 0;">
              <a href="http://validator.w3.org/check?uri=referer"
                 style="text-decoration: none;">
                <img style="border:0;width:88px;height:31px;top:0px;"
                     src="../res/image/valid-xhtml10-blue.png"
                     alt="Valid XHTML 1.0!"/>
              </a>
            </td>
            <td>
              <a href="http://jigsaw.w3.org/css-validator/check/referer"
                 style="text-decoration: none;">
                <img style="border:0;width:88px;height:31px;top:0px;"
                     src="../res/image/valid-css-blue.png"
                     alt="Valid CSS!" />
              </a>
            </td>
          </tr>
        </table>
        <span class="footdate">
          Last updated Mar. 20, 2009
        </span>
        <br />
        [ <a href="#top">Top</a> | <a href="/wiki/android/index.html">Up</a> | <a href="/wiki/./index.html">Dir</a> | <a href="/">Home</a> ]
      </td>
    </tr>
  </table>
</div>
<div id="collapsible-arrow" style="display:none;"></div>
</body>
<script language="javascript">
  getContent("../res/topic.html", "android_application");
  //afterload();
  fillsearch();
</script>
</html>
